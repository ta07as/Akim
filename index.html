<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Talas_master CRM — Большая База Данных</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --brand-black: #000000;
            --brand-gold: #FBBF24;
            --brand-white: #FFFFFF;
        }
        body {
            background-color: #050505;
            color: var(--brand-white);
            font-family: 'Inter', sans-serif;
        }
        .gold-border { border-color: var(--brand-gold); }
        .gold-text { color: var(--brand-gold); }
        .gold-bg { background-color: var(--brand-gold); }
        .card { background-color: #0f0f0f; border: 1px solid #1a1a1a; transition: all 0.2s; }
        .card:hover { border-color: #333; }
        
        /* Стилизация скроллбара */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #000; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--brand-gold); }

        input, select, textarea {
            background-color: #000 !important;
            border: 1px solid #222 !important;
            color: white !important;
        }
        input:focus { border-color: var(--brand-gold) !important; outline: none; ring: 1px var(--brand-gold); }

        .btn-nav { @apply flex items-center gap-3 w-full px-4 py-3 rounded-lg transition-all; }
        .btn-nav:hover { background-color: #1a1a1a; }
        .active-nav { background-color: #FBBF24 !important; color: #000 !important; font-weight: bold; }
    </style>
</head>
<body class="min-h-screen flex flex-col md:flex-row">

    <!-- Mobile Header -->
    <div class="md:hidden bg-black p-4 border-b border-zinc-800 flex justify-between items-center">
        <div class="font-bold uppercase tracking-tighter">TALAS<span class="gold-text">_MASTER</span></div>
        <button onclick="toggleSidebar()" class="gold-text text-2xl"><i class="fas fa-bars"></i></button>
    </div>

    <!-- Sidebar -->
    <aside id="sidebar" class="fixed inset-y-0 left-0 z-50 w-72 bg-black border-r border-zinc-800 transform -translate-x-full md:translate-x-0 md:relative transition-transform duration-300 ease-in-out flex flex-col">
        <div class="p-8 border-b border-zinc-900 hidden md:block">
            <div class="text-2xl font-black tracking-tighter uppercase leading-none">
                TALAS<br><span class="gold-text">_MASTER</span>
            </div>
            <p class="text-[10px] text-zinc-500 mt-2 tracking-widest uppercase">Система управления базой</p>
        </div>

        <nav class="flex-1 p-4 space-y-1 overflow-y-auto">
            <button onclick="showSection('dashboard')" id="nav-dashboard" class="btn-nav active-nav">
                <i class="fas fa-th-large"></i> Панель управления
            </button>
            <button onclick="showSection('database')" id="nav-database" class="btn-nav">
                <i class="fas fa-database"></i> База заказов
            </button>
            <button onclick="showSection('add')" id="nav-add" class="btn-nav">
                <i class="fas fa-plus-square"></i> Добавить запись
            </button>
            <button onclick="exportData()" class="btn-nav text-zinc-400 mt-10">
                <i class="fas fa-file-download"></i> Скачать отчет (TXT)
            </button>
        </nav>

        <div class="p-4 border-t border-zinc-900">
            <div class="bg-zinc-900/50 p-4 rounded-lg">
                <div class="text-[10px] text-zinc-500 uppercase mb-1">Версия системы</div>
                <div class="text-xs font-bold">3.5 PRO / Enterprise</div>
            </div>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 flex flex-col min-w-0">
        <!-- Top Search Bar -->
        <header class="h-16 bg-black/50 backdrop-blur-md border-b border-zinc-900 flex items-center px-4 md:px-8 justify-between sticky top-0 z-40">
            <div class="relative w-full max-w-md">
                <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-zinc-600"></i>
                <input type="text" id="globalSearch" oninput="searchOrders()" placeholder="Поиск по имени или телефону..." class="w-full pl-10 pr-4 py-2 rounded-full text-sm">
            </div>
            <div class="flex items-center gap-4 ml-4">
                <div class="hidden sm:block text-right">
                    <div class="text-xs font-bold uppercase tracking-widest">Администратор</div>
                    <div class="text-[10px] text-green-500 flex items-center justify-end gap-1">
                        <span class="w-1.5 h-1.5 bg-green-500 rounded-full"></span> Online
                    </div>
                </div>
            </div>
        </header>

        <!-- Dynamic Content -->
        <div class="p-4 md:p-8 overflow-y-auto" id="main-area">
            
            <!-- SECTION: DASHBOARD -->
            <div id="section-dashboard" class="space-y-8">
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                    <div class="card p-6 rounded-xl">
                        <div class="flex justify-between items-start mb-4">
                            <div class="w-10 h-10 bg-blue-500/10 rounded flex items-center justify-center text-blue-500"><i class="fas fa-list"></i></div>
                            <span class="text-[10px] text-zinc-500">ВСЕГО</span>
                        </div>
                        <h3 class="text-4xl font-black" id="dash-total">0</h3>
                        <p class="text-xs text-zinc-500 mt-2 italic">записей в базе</p>
                    </div>
                    <div class="card p-6 rounded-xl border-l-4 border-red-600">
                        <div class="flex justify-between items-start mb-4">
                            <div class="w-10 h-10 bg-red-500/10 rounded flex items-center justify-center text-red-500"><i class="fas fa-clock"></i></div>
                            <span class="text-[10px] text-zinc-500">НОВЫЕ</span>
                        </div>
                        <h3 class="text-4xl font-black text-red-500" id="dash-pending">0</h3>
                        <p class="text-xs text-zinc-500 mt-2 italic">ждут начала</p>
                    </div>
                    <div class="card p-6 rounded-xl border-l-4 border-yellow-500">
                        <div class="flex justify-between items-start mb-4">
                            <div class="w-10 h-10 bg-yellow-500/10 rounded flex items-center justify-center text-yellow-500"><i class="fas fa-tools"></i></div>
                            <span class="text-[10px] text-zinc-500">В РАБОТЕ</span>
                        </div>
                        <h3 class="text-4xl font-black text-yellow-500" id="dash-progress">0</h3>
                        <p class="text-xs text-zinc-500 mt-2 italic">текущие задачи</p>
                    </div>
                    <div class="card p-6 rounded-xl border-l-4 border-green-500">
                        <div class="flex justify-between items-start mb-4">
                            <div class="w-10 h-10 bg-green-500/10 rounded flex items-center justify-center text-green-500"><i class="fas fa-check-double"></i></div>
                            <span class="text-[10px] text-zinc-500">ГОТОВО</span>
                        </div>
                        <h3 class="text-4xl font-black text-green-500" id="dash-done">0</h3>
                        <p class="text-xs text-zinc-500 mt-2 italic">завершено работ</p>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <div class="lg:col-span-2 card p-6 rounded-xl">
                        <h4 class="text-sm font-bold uppercase tracking-widest mb-6 flex items-center gap-2">
                            <i class="fas fa-bolt gold-text"></i> Свежие поступления
                        </h4>
                        <div id="dashboard-recent" class="space-y-3">
                            <!-- JS -->
                        </div>
                    </div>
                    <div class="card p-6 rounded-xl bg-gradient-to-br from-zinc-900 to-black">
                        <h4 class="text-sm font-bold uppercase tracking-widest mb-4">Быстрые действия</h4>
                        <div class="grid grid-cols-1 gap-2">
                            <button onclick="showSection('add')" class="gold-bg text-black font-bold p-3 rounded-lg text-xs uppercase transition-transform active:scale-95">Принять новый заказ</button>
                            <a href="https://wa.me/996755000228" target="_blank" class="bg-zinc-800 text-white font-bold p-3 rounded-lg text-xs uppercase text-center border border-zinc-700">Открыть WhatsApp</a>
                        </div>
                        <div class="mt-8 border-t border-zinc-800 pt-4">
                            <p class="text-[10px] text-zinc-500">Инструменты базы данных помогут вам не терять контакты клиентов и вести учет прибыли по каждому объекту.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- SECTION: DATABASE -->
            <div id="section-database" class="hidden space-y-6">
                <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
                    <h3 class="text-xl font-black uppercase">Полный реестр базы</h3>
                    <div class="flex gap-2">
                        <select id="filterType" onchange="renderDatabase()" class="text-xs p-2 rounded-lg">
                            <option value="all">Все услуги</option>
                            <option value="Электрика">Электрика</option>
                            <option value="Сантехника">Сантехника</option>
                            <option value="Клининг">Клининг</option>
                            <option value="Кладка">Кладка</option>
                            <option value="Обои">Обои</option>
                        </select>
                    </div>
                </div>

                <div class="card rounded-xl overflow-hidden">
                    <div class="overflow-x-auto">
                        <table class="w-full text-left">
                            <thead class="bg-zinc-900 text-[10px] font-bold uppercase tracking-widest text-zinc-500">
                                <tr>
                                    <th class="p-4">ID / Дата</th>
                                    <th class="p-4">Клиент</th>
                                    <th class="p-4">Услуга / Адрес</th>
                                    <th class="p-4">Стоимость</th>
                                    <th class="p-4">Статус</th>
                                    <th class="p-4 text-right">Управление</th>
                                </tr>
                            </thead>
                            <tbody id="db-table-body" class="text-sm divide-y divide-zinc-900">
                                <!-- JS -->
                            </tbody>
                        </table>
                    </div>
                    <div id="empty-db" class="p-20 text-center text-zinc-700 hidden">
                        <i class="fas fa-database text-5xl mb-4"></i>
                        <p>База данных пуста. Добавьте первую запись.</p>
                    </div>
                </div>
            </div>

            <!-- SECTION: ADD -->
            <div id="section-add" class="hidden max-w-3xl mx-auto">
                <div class="card p-8 rounded-2xl border-t-4 gold-border shadow-2xl">
                    <div class="flex items-center gap-4 mb-8">
                        <div class="w-12 h-12 gold-bg rounded-xl flex items-center justify-center text-black text-xl">
                            <i class="fas fa-user-plus"></i>
                        </div>
                        <div>
                            <h3 class="text-xl font-bold uppercase tracking-tight">Новая запись в базу</h3>
                            <p class="text-xs text-zinc-500">Введите полные данные для детального учета</p>
                        </div>
                    </div>

                    <form id="orderForm" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="space-y-1">
                            <label class="text-[10px] font-bold text-zinc-500 uppercase ml-1">Имя заказчика</label>
                            <input type="text" id="form-name" required class="w-full p-3 rounded-xl border border-zinc-800">
                        </div>
                        <div class="space-y-1">
                            <label class="text-[10px] font-bold text-zinc-500 uppercase ml-1">Номер телефона</label>
                            <input type="tel" id="form-phone" value="+996 " required class="w-full p-3 rounded-xl border border-zinc-800">
                        </div>
                        <div class="space-y-1">
                            <label class="text-[10px] font-bold text-zinc-500 uppercase ml-1">Тип услуги</label>
                            <select id="form-type" class="w-full p-3 rounded-xl border border-zinc-800">
                                <option>Электрика</option>
                                <option>Сантехника</option>
                                <option>Клининг</option>
                                <option>Кладка кирпича</option>
                                <option>Поклейка обоев</option>
                            </select>
                        </div>
                        <div class="space-y-1">
                            <label class="text-[10px] font-bold text-zinc-500 uppercase ml-1">Бюджет / Цена (сом)</label>
                            <input type="number" id="form-price" placeholder="0" class="w-full p-3 rounded-xl border border-zinc-800">
                        </div>
                        <div class="md:col-span-2 space-y-1">
                            <label class="text-[10px] font-bold text-zinc-500 uppercase ml-1">Адрес объекта</label>
                            <input type="text" id="form-address" placeholder="Город, улица, дом..." class="w-full p-3 rounded-xl border border-zinc-800">
                        </div>
                        <div class="md:col-span-2 space-y-1">
                            <label class="text-[10px] font-bold text-zinc-500 uppercase ml-1">Дополнительные заметки</label>
                            <textarea id="form-notes" rows="3" class="w-full p-3 rounded-xl border border-zinc-800"></textarea>
                        </div>
                        <div class="md:col-span-2 flex gap-3 pt-4">
                            <button type="submit" class="flex-1 gold-bg text-black font-black py-4 rounded-xl uppercase text-xs tracking-widest hover:brightness-110 active:scale-95 transition">Зафиксировать в базе</button>
                            <button type="button" onclick="showSection('dashboard')" class="px-6 bg-zinc-800 rounded-xl hover:bg-zinc-700 transition"><i class="fas fa-times"></i></button>
                        </div>
                    </form>
                </div>
            </div>

        </div>
    </main>

    <!-- Notification -->
    <div id="notify" class="fixed bottom-8 right-8 bg-white text-black p-4 rounded-xl font-bold shadow-2xl translate-y-20 opacity-0 transition-all z-[100] flex items-center gap-3 border-l-4 border-yellow-500">
        <i class="fas fa-info-circle gold-text"></i>
        <span id="notify-text">Действие выполнено</span>
    </div>

    <script>
        // Core Data
        let db = JSON.parse(localStorage.getItem('talas_master_db_v3')) || [];

        function persist() {
            localStorage.setItem('talas_master_db_v3', JSON.stringify(db));
            updateStats();
            renderDashboard();
            renderDatabase();
        }

        // Navigation
        function showSection(id) {
            ['dashboard', 'database', 'add'].forEach(s => {
                document.getElementById(`section-${s}`).classList.add('hidden');
                document.getElementById(`nav-${s}`).classList.remove('active-nav');
            });
            document.getElementById(`section-${id}`).classList.remove('hidden');
            document.getElementById(`nav-${id}`).classList.add('active-nav');
            
            if (window.innerWidth < 768) toggleSidebar();
        }

        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('-translate-x-full');
        }

        // Logic
        document.getElementById('orderForm').onsubmit = (e) => {
            e.preventDefault();
            const entry = {
                id: 'TM-' + Math.floor(1000 + Math.random() * 9000),
                name: document.getElementById('form-name').value,
                phone: document.getElementById('form-phone').value,
                type: document.getElementById('form-type').value,
                price: document.getElementById('form-price').value || 0,
                address: document.getElementById('form-address').value || 'Не указан',
                notes: document.getElementById('form-notes').value,
                status: 'pending',
                date: new Date().toLocaleDateString('ru-RU'),
                created: Date.now()
            };
            db.unshift(entry);
            persist();
            e.target.reset();
            document.getElementById('form-phone').value = "+996 ";
            showSection('database');
            notify('Новая запись добавлена в базу');
        };

        function changeStatus(id, newStatus) {
            db = db.map(o => o.id === id ? {...o, status: newStatus} : o);
            persist();
            notify('Статус заказа изменен');
        }

        function deleteRecord(id) {
            if (confirm('Вы действительно хотите УДАЛИТЬ запись из базы данных?')) {
                db = db.filter(o => o.id !== id);
                persist();
                notify('Запись удалена', 'border-red-500');
            }
        }

        // Rendering
        function updateStats() {
            document.getElementById('dash-total').innerText = db.length;
            document.getElementById('dash-pending').innerText = db.filter(o => o.status === 'pending').length;
            document.getElementById('dash-progress').innerText = db.filter(o => o.status === 'progress').length;
            document.getElementById('dash-done').innerText = db.filter(o => o.status === 'done').length;
        }

        function renderDashboard() {
            const list = document.getElementById('dashboard-recent');
            const recent = db.slice(0, 4);
            
            if (recent.length === 0) {
                list.innerHTML = `<p class="text-zinc-600 italic text-xs">Нет активных данных...</p>`;
                return;
            }

            list.innerHTML = recent.map(o => `
                <div class="flex items-center gap-4 p-3 hover:bg-zinc-900/50 rounded-lg transition border border-transparent hover:border-zinc-800">
                    <div class="w-8 h-8 rounded bg-zinc-800 flex items-center justify-center text-[10px] font-bold">#${o.id.split('-')[1]}</div>
                    <div class="flex-1">
                        <div class="text-xs font-bold">${o.name}</div>
                        <div class="text-[10px] text-zinc-500">${o.type} • ${o.date}</div>
                    </div>
                    <div class="text-xs font-bold gold-text">${o.price} сом</div>
                </div>
            `).join('');
        }

        function renderDatabase(results = null) {
            const body = document.getElementById('db-table-body');
            const empty = document.getElementById('empty-db');
            const filter = document.getElementById('filterType').value;
            
            let data = results || db;
            if (filter !== 'all' && !results) {
                data = db.filter(o => o.type.includes(filter));
            }

            if (data.length === 0) {
                body.innerHTML = '';
                empty.classList.remove('hidden');
                return;
            }
            empty.classList.add('hidden');

            body.innerHTML = data.map(o => `
                <tr class="hover:bg-zinc-900/30 transition">
                    <td class="p-4">
                        <div class="font-mono text-[10px] text-zinc-500">${o.id}</div>
                        <div class="text-[10px]">${o.date}</div>
                    </td>
                    <td class="p-4">
                        <div class="font-bold text-white">${o.name}</div>
                        <div class="text-[10px] text-zinc-500">${o.phone}</div>
                    </td>
                    <td class="p-4">
                        <div class="text-xs font-bold gold-text">${o.type}</div>
                        <div class="text-[10px] text-zinc-400 italic max-w-[150px] truncate">${o.address}</div>
                    </td>
                    <td class="p-4 font-bold text-xs">${o.price} <span class="text-[10px] text-zinc-500">сом</span></td>
                    <td class="p-4">
                        <select onchange="changeStatus('${o.id}', this.value)" class="text-[10px] font-bold uppercase p-1 rounded border-zinc-800 ${o.status === 'done' ? 'text-green-500' : (o.status === 'progress' ? 'text-yellow-500' : 'text-red-500')}">
                            <option value="pending" ${o.status === 'pending' ? 'selected' : ''}>Ожидание</option>
                            <option value="progress" ${o.status === 'progress' ? 'selected' : ''}>В работе</option>
                            <option value="done" ${o.status === 'done' ? 'selected' : ''}>Завершено</option>
                        </select>
                    </td>
                    <td class="p-4 text-right">
                        <button onclick="deleteRecord('${o.id}')" class="text-zinc-600 hover:text-red-500 transition px-2"><i class="fas fa-trash"></i></button>
                    </td>
                </tr>
            `).join('');
        }

        function searchOrders() {
            const query = document.getElementById('globalSearch').value.toLowerCase();
            const filtered = db.filter(o => 
                o.name.toLowerCase().includes(query) || 
                o.phone.includes(query) ||
                o.id.toLowerCase().includes(query)
            );
            renderDatabase(filtered);
            if (query !== "") showSection('database');
        }

        function exportData() {
            if(db.length === 0) return notify('База пуста для экспорта');
            let content = "ОТЧЕТ БАЗЫ ДАННЫХ TALAS_MASTER\n============================\n\n";
            db.forEach(o => {
                content += `ID: ${o.id} | Дата: ${o.date}\nКлиент: ${o.name} (${o.phone})\nУслуга: ${o.type} | Цена: ${o.price} сом\nАдрес: ${o.address}\nЗаметки: ${o.notes}\n----------------------------\n`;
            });
            
            const blob = new Blob([content], { type: 'text/plain' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `talas_master_db_${new Date().toLocaleDateString()}.txt`;
            a.click();
            notify('Отчет успешно скачан');
        }

        function notify(text, extraClass = '') {
            const el = document.getElementById('notify');
            document.getElementById('notify-text').innerText = text;
            el.className = `fixed bottom-8 right-8 bg-white text-black p-4 rounded-xl font-bold shadow-2xl transition-all z-[100] flex items-center gap-3 border-l-4 border-yellow-500 opacity-100 translate-y-0 ${extraClass}`;
            setTimeout(() => {
                el.classList.add('opacity-0', 'translate-y-20');
            }, 3000);
        }

        // Init
        window.onload = () => {
            updateStats();
            renderDashboard();
            renderDatabase();
        };
    </script>
</body>
</html>
